javascript:(()=>{function e(e,t){const n=document.createElement(t);return n.className="content-enhancer",n.innerHTML=e,n}const t=document.head,n=e("body{margin: 0;background-color: black}img, video{display: block;width: 100%}video{margin: 100px 0}.loading{background-color: hsl(30, 75%, 50%)}.loaded{background-color: hsl(120, 75%, 50%)}.clicked{opacity: 0.5}.duration{position: absolute;background-color: rgba(0, 0, 0, 0.7);font-family: sans-serif;color: white;z-index: 1;padding: 5px;bottom: 0}.thumbnail-container{position: relative}.latest-container{position: absolute;bottom: 0;display: flex;align-items: center;width: 100%;font-family: sans-serif;color: white}.last-read-element, .last-available-element{background-color: rgba(0, 0, 0, 0.5);width: 50%}.last-read-element > div:nth-child(2), .last-available-element > div:nth-child(2){font-size: 2rem}.go-back-video{width: 100%;height: 100vh;background-color: hsl(0, 50%, 25%)}.refresh{margin: 200px 0}.go-back-manga, .go-back{width: 100%;height: 30vh;background-color: hsl(0, 50%, 25%)}.refresh, .chapter-button{font-size: 1.2rem;line-height: 3;text-align: center;width: 100%}.chapter-container{display: flex;font-size: 1.2rem;font-family: sans-serif;color: white;align-items: center}.last-read-container{width: 100%}.last-read{margin-left: 10px}.l2-thumbnail{width: 50%}.go-back{position: fixed;left: 0;top: 0;animation: fadeout 1s linear 0s 1 normal forwards running}@keyframes fadeout{0%{opacity: 1}100%{opacity: 0}}.clicker{background-color: rgba(0, 0, 0, 0.0);z-index: 1}.clicker, .info, .info-clicked{position: fixed;left: 0;top: 30%;height: 30%;width: 100%}.info{display: none}.info-clicked{display: flex;background-color: rgba(0, 0, 0, 0.7);justify-content: center;align-items: center}.info-content{font-size: 1.1rem;font-family: sans-serif;color: white;line-height: 2;margin: 20px}","style");t.appendChild(n);const a="script",o=e("async function loadL1(){if(nextSearchResultsHref!==EMPTY_STRING){const e=document.getElementById(L1_CONTAINER_ID),t=await getResponseDocument(nextSearchResultsHref),s=getSearchResultsThumbnails(t);setNextSearchResultsHref(t),observeLastImage(s,THUMBNAIL),await loadThumbnail(s,e)}}",a);t.appendChild(o);const r=e('let level1ScrollPosition;const chapters=[],DATA_LOAD_STATUS="data-load-status",LOADED="loaded",LOADING="loading";async function loadL2(e){originalHref.includes(TOKYOMOTION)||originalHref.includes(KISSJAV)?await loadVideo(e):(originalHref.includes(NHENTAI)||originalHref.includes(ASURASCANS))&&await loadManga(e)}function goToL1(e){const t=e.parentElement;document.getElementById(L1_CONTAINER_ID).style.display=BLOCK,t.remove();const n=t.getAttribute(DATA_HREF),l=document.getElementById(LAST_READ_1+n),o=document.getElementById(LAST_READ_2+n),a=document.getElementById(LAST_AVAILABLE_2+n);updateLastReadChapter(chapters,l,o,a),window.scrollTo({top:level1ScrollPosition})}async function loadVideo(e){const t=e.getAttribute(DATA_HREF),n=t,l=e.parentElement,o=e.getAttribute(DATA_LOAD_STATUS)===LOADED,a=e.getAttribute(DATA_LOAD_STATUS)===LOADING;if(o)level1ScrollPosition=window.scrollY,window.scrollTo({top:0}),e.removeAttribute(DATA_LOAD_STATUS),l.removeAttribute("class"),document.getElementById(L1_CONTAINER_ID).style.display=NONE,document.getElementById(n).style.display=BLOCK;else if(a);else{e.setAttribute(DATA_LOAD_STATUS,LOADING),e.className="clicked",l.className=LOADING;const o=document.createElement("div");o.id=n,o.style.display=NONE,document.body.appendChild(o);const a=document.createElement("video");a.controls=!0,a.preload="auto",a.playsInline=!0,a.muted=!0,a.onloadedmetadata=async()=>{a.onloadedmetadata=null,await waitFor(100),await a.play(),await waitFor(100),a.pause(),e.setAttribute(DATA_LOAD_STATUS,LOADED),l.className=LOADED},a.onerror=async()=>{await waitFor(5e3),a.load()};const c=document.createElement("source"),r=await getResponseDocument(t);let i;t.includes(TOKYOMOTION)?i=r.getElementById("vjsplayer"):t.includes(KISSJAV)&&(i=r.getElementById("player-fluid"));const s=i.querySelectorAll("source");let d=null;for(const e of s)(originalHref.includes(TOKYOMOTION)&&e.src.includes("/hd/")||originalHref.includes(KISSJAV)&&e.src.includes("720p"))&&(d=e.src);null===d&&(d=s[0].src),c.src=d,a.appendChild(c),o.appendChild(a),createBackButton(o,"goToL1","go-back-video");const A=document.createElement("button");A.className="refresh",A.type="button",A.onclick=()=>{a.scrollIntoView(),a.load()},A.innerText="Reload the video",o.appendChild(A)}}async function loadManga(e){level1ScrollPosition=window.scrollY,window.scrollTo({top:0});const t=e.getAttribute(DATA_HREF),n=document.createElement("div");n.id=L2_CONTAINER_ID,n.setAttribute(DATA_HREF,t),n.style.display=FLEX,document.body.appendChild(n),document.getElementById(L1_CONTAINER_ID).style.display=NONE,createBackButton(n,"goToL1","go-back-manga");const l=await getResponseDocument(t);if(originalHref.includes(NHENTAI)){n.style.flexDirection="row",n.style.flexWrap="wrap";const e=getGalleryThumbnails(l);await loadThumbnail(e,n)}else if(originalHref.includes(ASURASCANS)){n.style.flexDirection="column";const e=l.querySelectorAll("."+EPH_NUM);chapters.splice(0,0,...Array.from(e));for(const e of chapters){const t=e.children[0];currentChapterHref=t.href;const l=document.createElement("div");l.className="chapter-container";const o=document.createElement("button"),a=t.children[0];o.innerText=a.innerText,o.className="chapter-button",o.setAttribute(DATA_HREF,currentChapterHref),o.onclick=async()=>{await loadL3(o)},l.appendChild(o);const c=document.createElement("div");c.className="last-read-container";const r=document.createElement("span");r.className="last-read",r.id=currentChapterHref;const i=localStorage.getItem(currentChapterHref);r.innerText=null===i?"Never read":getTimeAgo(i),c.appendChild(r),l.appendChild(c),n.appendChild(l)}}}function getGalleryThumbnails(e){const t=[],n=Array.from(e.querySelector(".thumbs").children);for(const e of n){const n=e.children[0],l=n.children[0];l.src=l.getAttribute(DATA_SRC),pushThumbnail(l,n,"loadL3",t,"l2-thumbnail")}return t}',a);t.appendChild(r);const i=e('let level2ScrollPosition,nextImageHref,infoClicked,breakLoop;async function loadL3(e){breakLoop=!1,level2ScrollPosition=window.scrollY,window.scrollTo({top:0});const t=document.getElementById(L2_CONTAINER_ID),n=e.getAttribute(DATA_HREF),o=document.createElement("div");if(o.id=L3_CONTAINER_ID,document.body.appendChild(o),t.style.display=NONE,createBackButton(o,"goToL2","go-back"),createInfoButton(n,o),originalHref.includes(NHENTAI))nextImageHref=n,await loadNhImage(o);else if(originalHref.includes(ASURASCANS)){const e=await getAsImages(n);observeLastImage(e,IMAGE),await loadAsImage(e,o)}}function goToL2(e){document.getElementById(L2_CONTAINER_ID).style.display=FLEX,document.getElementById(e.parentElement.id).remove(),breakLoop=!0,retry=!0;document.getElementById(currentChapterHref).innerText=getTimeAgo(Date.now()+""),window.scrollTo({top:level2ScrollPosition})}async function loadNhImage(e){if(nextImageHref!==EMPTY_STRING&&!breakLoop){const t=await getResponseDocument(nextImageHref),n=t.getElementById("image-container").children[0].children[0],o=new Image;o.src=n.src,e.appendChild(o);const r=t.querySelector(".next");nextImageHref=null===r?EMPTY_STRING:r.href,o.onload=async()=>{await loadNhImage(e)},o.onerror=async()=>{await onImageLoadError(o)}}}async function getAsImages(e){const t=[],n=await getResponseDocument(e);if(null!==n){const o=[],r=n.getElementById("readerarea").children;for(let e=0;e<r.length;e++)r[e].getAttribute(CLASS)?.includes("ai-viewport-2")&&o.push(e);o.pop();for(const n of o){const o=r[n+2].children[0],a=new Image;a.setAttribute(DATA_HREF,e),a.setAttribute(DATA_SRC,o.getAttribute(DATA_CFSRC)),t.push(a)}}return t}async function loadAsImage(e,t,n=0){if(n<e.length&&!breakLoop){const o=e[n];t.append(o),o.src=o.getAttribute(DATA_SRC),o.onload=async()=>{await loadAsImage(e,t,++n)},o.onerror=async()=>{await onImageLoadError(o)}}else if(n===e.length){const n={root:null,rootMargin:LOOK_AHEAD},o=new IntersectionObserver(((n,o)=>{n.forEach((async n=>{if(n.isIntersecting){const r=n.target;o.unobserve(r),r.removeAttribute(CLASS);const a=getNextChapterHref(e);retry=!1;const c=await getAsImages(a);c.length>0&&(observeLastImage(c,IMAGE),await loadAsImage(c,t))}}))}),n),r=document.querySelector("."+IMAGE);o.observe(r);const a=new IntersectionObserver((e=>{e.forEach((async e=>{if(e.isIntersecting){const t=e.target,n=document.querySelector(".info-content");currentChapterHref=t.getAttribute(DATA_HREF),n.innerText=currentChapterHref,localStorage.setItem(currentChapterHref,Date.now()+"")}}))}),{root:null,rootMargin:"0px"});t.querySelectorAll("img").forEach((e=>{a.observe(e)}))}}function getNextChapterHref(e){const t=e[0].getAttribute(DATA_HREF).split("-"),n="chapter",o=t.indexOf(n),r=t[o+1],a=r.substring(0,r.length-1);let c;c=r.includes(".")?parseInt(a.split(".")[0])+1:parseInt(a)+1;let i=EMPTY_STRING;for(let e=0;e<o;e++)i+=t[e]+"-";return i+="chapter-"+c+"/",i}function createInfoButton(e,t){const n=document.createElement("div");n.className="info";const o=document.createElement("div");o.className="clicker",infoClicked=!1,o.onclick=()=>{infoClicked=!infoClicked,n.className=infoClicked?"info-clicked":"info"};const r=document.createElement("span");r.className="info-content",r.innerText=e,n.appendChild(r),t.appendChild(n),t.appendChild(o)}',a);t.appendChild(i);const l=e('const LOOK_AHEAD="1000%";let nextSearchResultsHref,originalHref,currentChapterHref,retry=!0;const L1_CONTAINER_ID="l1-container",L2_CONTAINER_ID="l2-container",L3_CONTAINER_ID="l3-container",THUMBNAIL="observeThumbnail",IMAGE="observeImage",EPH_NUM="eph-num",LAST_READ_1="lastRead1",LAST_READ_2="lastRead2",LAST_AVAILABLE_2="last-available-2",DATA_SRC="data-src",DATA_CFSRC="data-cfsrc",DATA_HREF="data-href",DATA_DURATION="data-duration",EMPTY_STRING="",ONCLICK="onclick",CLASS="class",BLOCK="block",FLEX="flex",NONE="none",TOKYOMOTION="tokyomotion",KISSJAV="kissjav",NHENTAI="nhentai",ASURASCANS="asurascans";function setNextSearchResultsHref(e){let t=null;originalHref.includes(TOKYOMOTION)?t=e.querySelector(".prevnext"):originalHref.includes(KISSJAV)?t=e.querySelector(".pagination-next"):originalHref.includes(NHENTAI)?t=e.querySelector(".next"):originalHref.includes(ASURASCANS)&&(t=e.querySelector(".r")),nextSearchResultsHref=null===t?"":t.href}function getSearchResultsThumbnails(e){const t=[],n=[];if(originalHref.includes(TOKYOMOTION)){const t=e.querySelectorAll(".thumb-popu");n.splice(0,0,...Array.from(t))}else if(originalHref.includes(KISSJAV)){const t=e.querySelector(".videos").children;n.splice(0,0,...Array.from(t))}else if(originalHref.includes(NHENTAI)){const t=e.querySelector(".index-container").children;n.splice(0,0,...Array.from(t))}else if(originalHref.includes(ASURASCANS)){const t=e.querySelectorAll(".imgu");n.splice(0,0,...Array.from(t))}for(const e of n){let n,a;if(originalHref.includes(TOKYOMOTION)){n=e;const t=n.children[0].children;a=t[0];const r=t[t.length-1];a.setAttribute(DATA_DURATION,r.innerText.trim())}else if(originalHref.includes(KISSJAV)){const t=e.children[0].children[0].children;if(n=t[0].children[0],a=n?.children[0],void 0===a)continue;null!==a.getAttribute(DATA_SRC)&&(a.src=a.getAttribute(DATA_SRC));const r=t[1];a.setAttribute(DATA_DURATION,r.innerHTML.split("/span>")[1])}else originalHref.includes(NHENTAI)?(n=e.children[0],a=n.children[0],null!==a.getAttribute(DATA_SRC)&&(a.src=a.getAttribute(DATA_SRC))):originalHref.includes(ASURASCANS)&&(n=e.children[0],a=n.children[0],null!==a.getAttribute(DATA_CFSRC)&&(a.src=a.getAttribute(DATA_CFSRC)));pushThumbnail(a,n,"loadL2",t,"l1-thumbnail")}return t}function pushThumbnail(e,t,n,a,r){const i=new Image;i.setAttribute(DATA_HREF,t.href),i.setAttribute(ONCLICK,n+"(this)"),i.setAttribute(DATA_SRC,e.src),i.className=r;const o=e.getAttribute(DATA_DURATION);null!==o&&i.setAttribute(DATA_DURATION,o),a.push(i)}async function getResponseDocument(e){const t=await getResponse(e);if(null!==t){const e=await t.text();return(new DOMParser).parseFromString(e,"text/html")}return null}async function getResponse(e){const t=await fetch(e);return 200===t.status?t:retry?(await waitFor(5e3),await getResponse(e)):null}async function waitFor(e){await new Promise((t=>setTimeout(t,e)))}async function onImageLoadError(e){await waitFor(5e3);let t=e.src;const n="?time=",a=t.indexOf(n),r=n+Date.now();-1!==a?t=t.substring(0,a)+r:t+=r,e.src=t}function appendToContainer(e,t){if(originalHref.includes(TOKYOMOTION)||originalHref.includes(KISSJAV)){const n=document.createElement("div");n.innerText=e.getAttribute(DATA_DURATION),n.className="duration";const a=document.createElement("div");a.className="thumbnail-container",a.appendChild(n),a.appendChild(e),t.appendChild(a)}else if(originalHref.includes(NHENTAI))t.appendChild(e);else if(originalHref.includes(ASURASCANS)){const n=e.getAttribute(DATA_HREF),a=document.createElement("div");a.className="latest-container";const r=document.createElement("div");r.className="last-read-element",a.appendChild(r);const i=document.createElement("div");i.className="last-available-element",a.appendChild(i);const o=document.createElement("div");o.id="lastRead1"+n,o.innerText="Loading",r.appendChild(o);const l=document.createElement("div");l.id="lastRead2"+n,l.innerText="Loading",r.appendChild(l);const c=document.createElement("div");c.innerText="Last available:",i.appendChild(c);const s=document.createElement("div");s.id=LAST_AVAILABLE_2+n,s.innerText="Loading",i.appendChild(s);getResponseDocument(n).then((e=>{const t=[],n=e.querySelectorAll(".eph-num");t.splice(0,0,...Array.from(n)),updateLastReadChapter(t,o,l,s)}));const d=document.createElement("div");d.className="thumbnail-container",d.appendChild(a),d.appendChild(e),t.append(d)}}function updateLastReadChapter(e,t,n,a){const r=[];let i=!1;for(let t=0;t<e.length;t++){const n=e[t].children[0],o=n.href,l=localStorage.getItem(o),c=n.children[0].innerText;if(null!==l){i=!0;const e=parseInt(l);r.push({chapterName:c,lastRead:e,chapterHref:o})}0===t&&(a.innerText=c)}if(i){const e=r.reduce(((e,t)=>e.lastRead>t.lastRead?e:t));t.innerText="Read: "+getTimeAgo(e.lastRead+""),n.innerText=e.chapterName}else t.innerText="Never read before",n.innerText="New"}function observeThumbnails(){const e=new IntersectionObserver(((e,t)=>{e.forEach((async e=>{if(e.isIntersecting){const n=e.target;t.unobserve(n),n.removeAttribute(CLASS),await loadL1()}}))}),{root:null,rootMargin:"1000%"}),t=document.querySelector("."+THUMBNAIL);e.observe(t)}async function loadThumbnail(e,t,n=0){if(n<e.length){const a=e[n];a.src=a.getAttribute(DATA_SRC),a.onload=async()=>{await loadThumbnail(e,t,++n)},a.onerror=async()=>{await onImageLoadError(a)},appendToContainer(a,t)}else n===e.length&&"l1-container"===t.id&&observeThumbnails()}function observeLastImage(e,t){const n=e.pop();n.className=t,e.push(n)}function createBackButton(e,t,n){const a=document.createElement("div");a.className=n,a.setAttribute(ONCLICK,t+"(this)"),e.appendChild(a)}function getTimeAgo(e){let t=(Date.now()-parseInt(e))/1e3,n=Math.floor(t)+" seconds ago";return n=getTime(n,t,60," minute ago"," minutes ago"),n=getTime(n,t,3600," hour ago"," hours ago"),n=getTime(n,t,86400," day ago"," days ago"),n=getTime(n,t,604800," week ago"," weeks ago"),n=getTime(n,t,2419200," month ago"," months ago"),n=getTime(n,t,29030400," year ago"," years ago"),n}function getTime(e,t,n,a,r){if(t>n){const i=Math.floor(t/n);e=1===i?i+a:Math.floor(t/n)+r}return e}(async()=>{originalHref=location.href,setNextSearchResultsHref(document);let e=getSearchResultsThumbnails(document);const t=document.querySelectorAll(".content-enhancer");document.body.parentElement.remove();const n=document.createElement("html"),a=document.createElement("body"),r=document.createElement("head");for(const e of t)r.appendChild(e);n.appendChild(r),n.appendChild(a),document.appendChild(n);const i=document.createElement("div");i.id="l1-container",a.appendChild(i),observeLastImage(e,THUMBNAIL),await loadThumbnail(e,i)})();',a);t.appendChild(l)})();
